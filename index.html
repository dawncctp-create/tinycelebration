
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- App name (what iOS shows on the home screen) -->
<meta name="apple-mobile-web-app-title" content="I did it!">
<meta name="application-name" content="I did it!">

<!-- iOS home screen icon -->
<link rel="apple-touch-icon" href="apple-touch-icon.png">

<!-- PWA manifest (Android/Chrome) -->
<link rel="manifest" href="manifest.json">

<!-- Theme colors (Android taskbar color, etc.) -->
<meta name="theme-color" content="#1b4332">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>Tiny Celebration</title>
  <style>
    :root{
      --bg:#E8F5E9;        /* background (60%) */
      --panel:#C8E6C9;     /* panel (30%) */
      --button:#FF9800;    /* accent button (10%) contrasting */
      --text:#0f172a;
      --muted:#334155;
      --border: rgba(15,23,42,.18);
      --ring:#22c55e;

      /* Star palette */
      --gold:#fbbf24;
      --gold-stroke:#0f5132;   /* deep green outline */
      --silver:#c0c0c0;
      --silver-stroke:#0f5132; /* deep green outline */
      --purple:#8b5cf6;        /* rich purple fill */
      --purple-stroke:#f59e0b; /* warm gold outline */
      /* Popup */
      --popup-bg:#0f5132;      /* deep green */
      --popup-fg:#f59e0b;      /* warm gold */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      display:flex; align-items:center; justify-content:center; padding:20px;
    }
    .wrap{ width:min(720px,96vw); }
    .card{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:28px;
      padding:24px 18px 28px;
      box-shadow:0 10px 28px rgba(0,0,0,.08);
    }

    /* ===== Stars rows (added) ===== */
    .stars{ display:grid; gap:6px; margin-bottom:12px }
    .row{ display:flex; gap:8px; justify-content:center; align-items:center }
    .star{ width:22px; height:22px; opacity:.95 }
    .star .fill{ opacity:0; transform:scale(.8); transform-origin:center }
    .star.filled .fill{ opacity:1; animation: starpop .18s ease-out }
    @keyframes starpop{ from{transform:scale(.6)} to{transform:scale(1)} }

    /* ===== Existing button & controls ===== */
    .big{
      appearance:none;
      display:block;
      width:100%;
      border:0;
      background:var(--button);
      color:#ffffff;
      font-weight:800;
      letter-spacing:.3px;
      border-radius:22px;
      font-size:clamp(22px,6vw,34px);
      padding:22px 26px;
      text-align:center;
      cursor:pointer;
      user-select:none;
      transition:transform .06s ease-out, filter .15s ease;
      position:relative;
      overflow:hidden;
    }
    .big:hover{ filter:brightness(1.03) }
    .big:active{ transform: scale(.98) }
    .big:focus-visible{ outline:3px solid #f59e0b; outline-offset:3px }
    .tagline{
      margin:14px 8px 10px;
      text-align:center;
      color:var(--muted);
      font-size:clamp(13px,3.3vw,15px);
    }
    .row-controls{
      margin-top:10px;
      display:flex; gap:12px; justify-content:center; flex-wrap:wrap;
    }
    .select{ position:relative; }
    .select select{
      appearance:none;
      border:1px solid var(--border);
      border-radius:14px;
      background:#ffffffa8;
      color:var(--text);
      font-weight:600;
      padding:10px 38px 10px 14px;
      font-size:16px;
      min-width:200px;
      text-transform:none;
      backdrop-filter:saturate(1.2) blur(2px);
    }
    .select:after{
      content:"â–¾";
      position:absolute; right:12px; top:50%; transform:translateY(-50%);
      pointer-events:none; color:#475569;
    }
    /* Subtle ring flash */
    .ring{
      animation: ring .65s ease-out;
      box-shadow:
        0 0 0 0 rgba(34,197,94,.85),
        0 0 18px 6px rgba(34,197,94,.35) inset,
        0 0 20px 6px rgba(34,197,94,.25);
    }
    @keyframes ring{
      0%{ box-shadow: 0 0 0 0 rgba(34,197,94,.85), 0 0 18px 6px rgba(34,197,94,.35) inset, 0 0 20px 6px rgba(34,197,94,.25) }
      100%{ box-shadow: 0 0 0 28px rgba(34,197,94,0), 0 0 0 0 rgba(34,197,94,0) inset, 0 0 0 0 rgba(34,197,94,0) }
    }

    /* Canvas for effects */
    #fx{ position:fixed; inset:0; pointer-events:none; z-index:10; }

    /* Popup toast */
    .toast{
      position:fixed; left:50%; top:16px; transform:translate(-50%,-8px) scale(.98);
      background:var(--popup-bg); color:var(--popup-fg);
      border:2px solid var(--popup-fg); border-radius:999px;
      padding:10px 16px; font-weight:800; letter-spacing:.2px;
      box-shadow:0 12px 30px rgba(0,0,0,.18);
      opacity:0; pointer-events:none; z-index:50;
      transition: opacity .25s ease, transform .25s ease;
    }
    .toast.show{ opacity:1; transform:translate(-50%,0) scale(1) }
    .toast.hide{ opacity:0; transform:translate(-50%,-8px) scale(.98) }

    @media (min-width: 800px){
      .wrap{ width:min(760px,92vw); }
      .card{ padding:32px 28px 36px; }
    }
    @media (prefers-reduced-motion: reduce){
      .ring{ animation:none !important }
      .star.filled .fill{ animation:none !important }
      .toast{ transition:none }
    }
  </style>
</head>
<body>
  <canvas id="fx"></canvas>
  <main class="wrap">
    <section class="card">

      <!-- ===== Stars (added) ===== -->
      <div class="stars" aria-label="Streak stars">
        <div class="row" id="row-purple" aria-label="Weeks (purple)"></div>
        <div class="row" id="row-gold" aria-label="Days (gold)"></div>
        <div class="row" id="row-silver" aria-label="Today (silver)"></div>
      </div>

      <button id="celebrate" class="big" aria-label="Celebrate. Double tap or press enter to celebrate.">
        I did it! ðŸŽ‰
      </button>
      <p class="tagline">Celebrate small wins, build big habits.</p>
      <div class="row-controls">
        <label class="select" aria-label="Effects">
          <select id="styleSel" aria-label="Effects select">
            <option value="confetti" selected>Confetti</option>
            <option value="firework">Firework</option>
            <option value="sparkle">Sparkle Only</option>
          </select>
        </label>
        <label class="select" aria-label="Sound">
          <select id="soundSel" aria-label="Sound select">
            <option value="off">Off</option>
            <option value="crowd" selected>Cheering Crowd</option>
            <option value="fanfare">Fanfare</option>
            <option value="trumpets">Trumpets</option>
          </select>
        </label>
      </div>

      <!-- MP3-only audio sources. IMPORTANT: these are RELATIVE paths that work on GitHub Pages.
           Put your MP3s at /assets/audio/ in your repo (same as the HTML root). -->
      <audio id="snd-crowd" preload="auto">
        <source src="assets/audio/crowd_cheer.mp3" type="audio/mpeg">
      </audio>
      <audio id="snd-fanfare" preload="auto">
        <source src="assets/audio/fanfare.mp3" type="audio/mpeg">
      </audio>
      <audio id="snd-trumpets" preload="auto">
        <source src="assets/audio/successtrumpets.mp3" type="audio/mpeg">
      </audio>
    </section>
  </main>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite">You did it!</div>

  <script>
  (function(){
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const btn = document.getElementById('celebrate');
    const styleSel = document.getElementById('styleSel');
    const soundSel = document.getElementById('soundSel');
    const canvas = document.getElementById('fx');
    const ctx = canvas.getContext('2d');
    let w=0,h=0, dpr=1, rafId=null;

    // ===== Stars state (added) =====
    const rowPurple = document.getElementById('row-purple');
    const rowGold   = document.getElementById('row-gold');
    const rowSilver = document.getElementById('row-silver');
    const toast = document.getElementById('toast');
    const sndCrowd = document.getElementById('snd-crowd');

    const STAR_KEY = "tc_stars_v2";
    const GRACE_ENABLED = true, GRACE_HOUR = 2; // 12â€“2am counts as prior day

    function isoWithGrace(d){
      const dt = new Date(d);
      if(GRACE_ENABLED && dt.getHours() < GRACE_HOUR){
        const y = new Date(dt); y.setDate(dt.getDate()-1); y.setHours(0,0,0,0);
        return y.toISOString().slice(0,10);
      }
      const t = new Date(dt); t.setHours(0,0,0,0); return t.toISOString().slice(0,10);
    }
    function todayISO(){ return isoWithGrace(new Date()); }

    function loadStars(){
      try{
        return JSON.parse(localStorage.getItem(STAR_KEY)) ??
          { today: todayISO(), todayCount:0, dayStreak:0, weekStreak:0, last: null };
      }catch{
        return { today: todayISO(), todayCount:0, dayStreak:0, weekStreak:0, last: null };
      }
    }
    let stars = loadStars();
    function saveStars(){ localStorage.setItem(STAR_KEY, JSON.stringify(stars)); }

    function rolloverIfNeeded(){
      const now = todayISO();
      if(stars.today !== now){
        // yesterday is closed; check if perfect
        if(stars.todayCount < 4){
          // full reset across all rows
          stars.todayCount = 0;
          stars.dayStreak = 0;
          stars.weekStreak = 0;
        }else{
          // perfect day already counted when it reached 4; just clear daily
          stars.todayCount = 0;
        }
        stars.today = now;
        saveStars();
        renderStars();
      }
    }

    function starSVG(kind, filled){
      const cfg = {
        silver: { fill:'var(--silver)', stroke:'var(--silver-stroke)' },
        gold:   { fill:'var(--gold)',   stroke:'var(--gold-stroke)' },
        purple: { fill:'var(--purple)', stroke:'var(--purple-stroke)' }
      }[kind];
      const ns = 'http://www.w3.org/2000/svg';
      const s = document.createElementNS(ns,'svg');
      s.setAttribute('viewBox','0 0 24 24'); s.setAttribute('class','star'+(filled?' filled':''));
      const path = "M12 2l2.9 6.1 6.7.6-5 4.4 1.5 6.6-6.1-3.4-6.1 3.4 1.5-6.6-5-4.4 6.7-.6L12 2z";
      const outline = document.createElementNS(ns,'path');
      outline.setAttribute('d', path);
      outline.setAttribute('fill','none');
      outline.setAttribute('stroke', cfg.stroke);
      outline.setAttribute('stroke-width','1.6');
      outline.setAttribute('opacity','0.9');
      const fill = document.createElementNS(ns,'path');
      fill.setAttribute('d', path);
      fill.setAttribute('class','fill');
      fill.setAttribute('fill', cfg.fill);
      s.appendChild(outline); s.appendChild(fill);
      return s;
    }

    function renderStars(){
      // Purple (weeks): show once weekStreak > 0; 5 slots loop
      rowPurple.innerHTML = "";
      if(stars.weekStreak > 0){
        const filled = ((stars.weekStreak - 1) % 5) + 1;
        for(let i=1;i<=5;i++) rowPurple.appendChild(starSVG('purple', i<=filled));
      }
      // Gold (days): show after first perfect day
      rowGold.innerHTML = "";
      if(stars.dayStreak > 0 || stars.weekStreak > 0){
        for(let i=1;i<=7;i++) rowGold.appendChild(starSVG('gold', i<=stars.dayStreak));
      }
      // Silver (today): always show 4 outlines
      rowSilver.innerHTML = "";
      for(let i=1;i<=4;i++) rowSilver.appendChild(starSVG('silver', i<=stars.todayCount));
    }

    function showToast(){
      toast.classList.remove('hide'); // reset
      // force reflow
      void toast.offsetWidth;
      toast.classList.add('show');
      try { sndCrowd.currentTime = 0; sndCrowd.play().catch(()=>{}); } catch(e){}
      setTimeout(()=> toast.classList.add('hide'), 1400);
      setTimeout(()=> toast.classList.remove('show'), 1500);
    }

    // ===== Existing canvas/effects setup (unchanged) =====
    function resize(){
      dpr = Math.max(1, Math.min(window.devicePixelRatio || 1, 2));
      w = canvas.width = Math.floor(window.innerWidth * dpr);
      h = canvas.height = Math.floor(window.innerHeight * dpr);
      canvas.style.width = window.innerWidth + 'px';
      canvas.style.height = window.innerHeight + 'px';
      ctx.setTransform(1,0,0,1,0,0);
    }
    window.addEventListener('resize', resize, {passive:true}); resize();

    const audios = {
      "crowd": document.getElementById('snd-crowd'),
      "fanfare": document.getElementById('snd-fanfare'),
      "trumpets": document.getElementById('snd-trumpets')
    };
    function playSelected(){
      const key = soundSel.value;
      if(key === 'off') return;
      const el = audios[key];
      if(!el) return;
      try { el.currentTime = 0; el.play().catch(()=>{}); } catch(e){}
    }

    function celebrate(){
      rolloverIfNeeded();

      // ===== Stars progression (added) =====
      const before = stars.todayCount;
      if(stars.todayCount < 4){
        stars.todayCount++;
        if(before === 3){
          // completed a perfect day
          stars.dayStreak = Math.min(7, stars.dayStreak + 1);
          if(stars.dayStreak === 7){
            stars.weekStreak += 1;
            stars.dayStreak = 0;
            // On every 5th purple completion, show popup + cheering
            if(stars.weekStreak % 5 === 0){
              showToast();
            }
          }
        }
        saveStars();
        renderStars();
      }

      // ===== Original celebration visuals/sounds =====
      if(!prefersReduced && btn.animate){
        btn.animate([{transform:'scale(1)'},{transform:'scale(1.06)'},{transform:'scale(1)'}], {duration:200,easing:'ease-out'});
      }
      btn.classList.add('ring'); setTimeout(()=>btn.classList.remove('ring'), 700);

      playSelected();
      if(prefersReduced) return;

      const rect = btn.getBoundingClientRect();
      const cx = (rect.left + rect.width/2) * dpr;
      const cy = (rect.top + rect.height/2) * dpr;

      const style = styleSel.value;
      if(style === 'confetti'){ confetti(cx, cy, 260); }
      else if(style === 'firework'){ firework(cx, cy); }
      else { sparkleDOM(btn, 120); }
    }

    // --- Confetti ---
    const COLORS = ['#F97316','#22C55E','#38BDF8','#A78BFA','#F43F5E','#EAB308','#10B981','#60A5FA','#fb7185','#93c5fd'];
    function confetti(cx, cy, count){
      const parts=[];
      for(let i=0;i<count;i++){
        const angle=Math.random()*Math.PI*2, speed=6+Math.random()*6, size=6+Math.random()*8;
        const color=COLORS[(Math.random()*COLORS.length)|0];
        const shape=Math.random()<0.2?'circle':'rect';
        parts.push({x:cx,y:cy,vx:Math.cos(angle)*speed,vy:Math.sin(angle)*speed-6,g:0.18+Math.random()*0.12,s:size,a:1,spin:(Math.random()<0.5?-1:1)*(0.08+Math.random()*0.12),rot:Math.random()*Math.PI,color,shape});
      }
      animateParts(parts,(p)=>{
        ctx.globalAlpha=Math.max(0,p.a); ctx.fillStyle=p.color;
        ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot);
        if(p.shape==='rect'){ ctx.fillRect(-p.s/2,-p.s/2,p.s,p.s*0.6); }
        else{ ctx.beginPath(); ctx.arc(0,0,p.s*0.5,0,Math.PI*2); ctx.fill(); }
        ctx.restore(); ctx.globalAlpha=1;
      });
    }

    // --- Firework ---
    function firework(cx, cy){
      const parts=[]; const rays=26;
      for(let i=0;i<rays;i++){ const a=(i/rays)*Math.PI*2 + Math.random()*0.12; const s=8+Math.random()*3; parts.push(makeP(cx,cy,a,s,randColor(),'ray')); }
      const ring=48;
      for(let i=0;i<ring;i++){ const a=(i/ring)*Math.PI*2; const s=6+Math.random()*2; parts.push(makeP(cx,cy,a,s,randColor(),'dot')); }
      setTimeout(()=>{ for(let i=0;i<42;i++){ const a=Math.random()*Math.PI*2; const s=7+Math.random()*3; parts.push(makeP(cx,cy,a,s,randColor(),'crackle',0.9)); }},120);
      animateParts(parts,(p)=>{
        if(p.trail && p.trail.length>1){
          ctx.strokeStyle=p.color; ctx.globalAlpha=0.35; ctx.lineWidth=2*(p.type==='ray'?1.2:1);
          ctx.beginPath(); ctx.moveTo(p.trail[0].x,p.trail[0].y); for(let i=1;i<p.trail.length;i++) ctx.lineTo(p.trail[i].x,p.trail[i].y); ctx.stroke(); ctx.globalAlpha=1;
        }
        ctx.fillStyle=p.color; ctx.globalAlpha=Math.max(0,p.a);
        if(p.type==='dot'||p.type==='crackle'){ ctx.beginPath(); ctx.arc(p.x,p.y,3.2,0,Math.PI*2); ctx.fill(); }
        else{ ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(Math.atan2(p.vy,p.vx)); ctx.fillRect(-2,-1.6,10,3.2); ctx.restore(); }
        ctx.globalAlpha=1;
      },{air:0.008,gravity:0.09,fade:0.010,trail:10,drag:0.012});
    }
    function makeP(cx,cy,a,s,color,type='dot',alpha=1){ return {x:cx,y:cy,vx:Math.cos(a)*s,vy:Math.sin(a)*s-4,a:alpha,color,type,trail:[]}; }
    function randColor(){ const C=['#F97316','#22C55E','#38BDF8','#A78BFA','#F43F5E','#EAB308','#10B981','#60A5FA','#fb7185','#93c5fd']; return C[(Math.random()*C.length)|0]; }

    // --- Sparkle DOM ---
    function sparkleDOM(target,count){
      const rect=target.getBoundingClientRect(); const cx=rect.left+rect.width/2+window.scrollX; const cy=rect.top+rect.height/2+window.scrollY;
      for(let i=0;i<count;i++){
        const p=document.createElement('span'); p.className='sparkle';
        const ang=Math.random()*Math.PI*2; const dist=90+Math.random()*90;
        p.style.position='absolute'; p.style.width='10px'; p.style.height='10px'; p.style.borderRadius='50%';
        p.style.pointerEvents='none'; p.style.willChange='transform,opacity';
        p.style.background='radial-gradient(circle at 30% 30%, #fff, #60a5fa 40%, transparent 60%)';
        p.style.opacity='0'; p.style.transform='translate(-50%,-50%) scale(.6)';
        p.style.setProperty('--dx', Math.cos(ang)*dist+'px'); p.style.setProperty('--dy', Math.sin(ang)*dist+'px');
        document.body.appendChild(p); p.style.left=cx+'px'; p.style.top=cy+'px';
        p.animate([{transform:'translate(-50%,-50%) scale(.6)', opacity:.95},
                   {transform:`translate(var(--dx), var(--dy)) scale(1)`, opacity:0}],
                  {duration:520+Math.random()*280, easing:'cubic-bezier(.16,1,.3,1)', fill:'forwards'});
        setTimeout(()=>p.remove(),1200);
      }
    }

    // --- Shared animation loop ---
    function animateParts(parts, draw, opts){
      if(rafId) cancelAnimationFrame(rafId);
      const air=opts?.air ?? 0.005, gravity=opts?.gravity ?? 0.18, fade=opts?.fade ?? 0.012, trailLen=opts?.trail ?? 0, drag=opts?.drag ?? 0;
      let last=performance.now();
      function frame(t){
        ctx.clearRect(0,0,w,h);
        const dt=Math.min(32,t-last)/16.6667; last=t;
        for(const p of parts){
          p.vx*=(1-drag*dt); p.vy=(p.vy+gravity*dt)*(1-air*dt); p.x+=p.vx*dt; p.y+=p.vy*dt; p.a-=fade*dt;
          if(trailLen){ p.trail.push({x:p.x,y:p.y}); if(p.trail.length>trailLen) p.trail.shift(); }
        }
        for(const p of parts){ if(p.a>0) draw(p); }
        const alive=parts.some(p=>p.a>0 && p.y<h+60);
        if(alive) rafId=requestAnimationFrame(frame); else { ctx.clearRect(0,0,w,h); rafId=null; }
      }
      rafId=requestAnimationFrame(frame);
    }

    // wire
    btn.addEventListener('click', celebrate);
    btn.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); celebrate(); }});
    // initial paint
    rolloverIfNeeded();
    renderStars();
    btn.focus();
  })();
  </script>
</body>
</html>
