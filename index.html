<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>I did it! â€” Confetti + Firework (Sound Menu)</title>
  <style>
    :root{
      --bg:#0f172a; --panel:#0b1320; --text:#e5e7eb; --muted:#94a3b8;
      --focus:#f59e0b; --btn:#111827; --border: rgba(148,163,184,.35);
      --ring:#22c55e;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f8fafc; --panel:#ffffff; --text:#0f172a; --muted:#475569; --btn:#ffffff; --border: rgba(15,23,42,.2); --focus:#b45309; --ring:#16a34a; }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:radial-gradient(1200px 600px at 50% -10%, rgba(255,255,255,.06), transparent), linear-gradient(145deg,var(--bg),#0b1320 60%);
      color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .app{width:min(820px,96vw); display:grid; gap:16px; justify-items:center; text-align:center}
    .card{
      background:var(--panel); border:1px solid rgba(148,163,184,.25); border-radius:16px;
      padding:20px; width:100%; max-width:640px; box-shadow:0 10px 30px rgba(0,0,0,.15);
    }
    .button{
      appearance:none; border:2px solid var(--border); border-radius:14px;
      background:var(--btn); color:var(--text); font-weight:800; letter-spacing:.5px;
      padding:18px 26px; font-size:clamp(22px,3.6vw,28px);
      cursor:pointer; user-select:none; position:relative; overflow:hidden;
      transition:transform .1s ease-out, border-color .2s ease, box-shadow .2s ease;
    }
    .button:hover{ border-color: rgba(148,163,184,.7) }
    .button:active{ transform: scale(.98) }
    .button:focus-visible{ outline:3px solid var(--focus); outline-offset:3px }
    .row{display:flex; gap:12px; justify-content:center; flex-wrap:wrap; align-items:center; margin-top:12px}
    .toggle, .select{display:flex; align-items:center; gap:6px; font-size:14px; color:var(--muted)}
    select{background:var(--btn); color:var(--text); border:1px solid var(--border); border-radius:10px; padding:6px 10px}
    .hint{font-size:13px; color:var(--muted)}
    /* Sparkle particles (DOM extra) */
    .sparkle{
      position: absolute; width:10px; height:10px; border-radius:50%;
      pointer-events:none; will-change: transform, opacity;
      background: radial-gradient(circle at 30% 30%, #fff, #60a5fa 40%, transparent 60%);
      opacity: 0; transform: translate(-50%, -50%) scale(.6);
    }
    @keyframes pop {
      0%{ transform:translate(-50%,-50%) scale(.6); opacity:.95 }
      80%{ opacity:.95 }
      100%{ transform:translate(var(--dx), var(--dy)) scale(1); opacity:0 }
    }
    /* Stronger ring flash */
    .ring{
      animation: ring 0.65s ease-out;
      box-shadow:
        0 0 0 0 rgba(34,197,94,.85),
        0 0 18px 6px rgba(34,197,94,.35) inset,
        0 0 20px 6px rgba(34,197,94,.35);
    }
    @keyframes ring{
      0%{ box-shadow: 0 0 0 0 rgba(34,197,94,.85), 0 0 18px 6px rgba(34,197,94,.35) inset, 0 0 20px 6px rgba(34,197,94,.35) }
      100%{ box-shadow: 0 0 0 28px rgba(34,197,94,0), 0 0 0 0 rgba(34,197,94,0) inset, 0 0 0 0 rgba(34,197,94,0) }
    }
    /* Canvas overlay */
    #fx{ position:fixed; inset:0; pointer-events:none; z-index:10; }
    @media (prefers-reduced-motion: reduce){
      .sparkle{ display:none !important }
      .ring{ animation:none !important }
    }
  </style>
</head>
<body>
  <canvas id="fx"></canvas>
  <main class="app">
    <section class="card">
      <button id="celebrate" class="button" aria-describedby="kbd">
        I did it! ðŸŽ‰
      </button>
      <div class="row">
        <label class="select">Effects
          <select id="styleSel">
            <option value="confetti" selected>confetti</option>
            <option value="firework">firework</option>
            <option value="sparkle">sparkle only</option>
          </select>
        </label>
        <label class="select">Sound
          <select id="soundSel">
            <option value="off">Off</option>
            <option value="sparkle" selected>Sparkle arpeggio</option>
            <option value="ta-da">Taâ€‘da chord</option>
            <option value="kalimba">Kalimba plucks</option>
          </select>
        </label>
        <label class="toggle"><input id="sparkChk" type="checkbox"> extra sparkles</label>
        <label class="toggle"><input id="flashChk" type="checkbox" checked> ring flash</label>
      </div>
      <div id="kbd" class="hint">Enter/Space to celebrate â€¢ Offline, no libraries â€¢ Respects <code>prefers-reduced-motion</code></div>
    </section>
  </main>

  <script>
  (function(){
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const btn = document.getElementById('celebrate');
    const sparkChk = document.getElementById('sparkChk');
    const flashChk = document.getElementById('flashChk');
    const styleSel = document.getElementById('styleSel');
    const soundSel = document.getElementById('soundSel');
    const canvas = document.getElementById('fx');
    const ctx = canvas.getContext('2d');
    let w=0,h=0, dpr=1, rafId=null;

    // ---- WebAudio synth (no assets) ----
    let audioCtx = null;
    function ac(){ if(!audioCtx){ const AC = window.AudioContext || window.webkitAudioContext; audioCtx = AC? new AC(): null; } if(audioCtx && audioCtx.state==='suspended'){ audioCtx.resume().catch(()=>{}); } return audioCtx; }
    function env(node, t, a=0.005, d=0.08, s=0.2, r=0.25, peak=1){
      const g = audioCtx.createGain();
      node.connect(g);
      g.gain.setValueAtTime(0.0001, t);
      g.gain.exponentialRampToValueAtTime(peak, t+a);
      g.gain.exponentialRampToValueAtTime(peak*s, t+a+d);
      g.gain.exponentialRampToValueAtTime(0.0001, t+a+d+r);
      return g;
    }
    function osc(type, f, t){ const o = audioCtx.createOscillator(); o.type=type; o.frequency.setValueAtTime(f,t); return o; }
    function note(f, t, dur=0.3, type='sine', peak=0.6){
      const o = osc(type,f,t);
      const e = env(o,t,0.005,0.08,0.25,dur,peak);
      e.connect(audioCtx.destination);
      o.start(t); o.stop(t+dur+0.02);
    }
    // Noise source for clap
    function noise(t, dur=0.15, tone=800){
      const sr = audioCtx.sampleRate, n = Math.floor(sr*dur);
      const buffer = audioCtx.createBuffer(1, n, sr);
      const data = buffer.getChannelData(0);
      for(let i=0;i<n;i++){ data[i] = (Math.random()*2-1) * Math.pow(1 - i/n, 2); }
      const src = audioCtx.createBufferSource(); src.buffer = buffer;
      const bp = audioCtx.createBiquadFilter(); bp.type='bandpass'; bp.frequency.setValueAtTime(tone, t); bp.Q.setValueAtTime(1.2, t);
      const g = audioCtx.createGain(); g.gain.setValueAtTime(0.7, t); g.gain.exponentialRampToValueAtTime(0.0001, t+dur);
      src.connect(bp); bp.connect(g); g.connect(audioCtx.destination);
      src.start(t); src.stop(t+dur);
    }

    function playSound(kind){
      const ctx = ac(); if(!ctx) return;
      const now = ctx.currentTime + 0.01;

      if(kind==='sparkle'){
        // Pentatonic arpeggio upwards with slight detune sparkles
        const base = 523.25; // C5
        const pent = [0,2,4,7,9]; // major pentatonic steps
        for(let i=0;i<5;i++){
          const f = base * Math.pow(2, pent[i]/12);
          const t = now + i*0.06;
          note(f, t, 0.28, i%2?'triangle':'sine', 0.5);
          // sprinkle detuned overtone
          note(f*2.01, t+0.015, 0.18, 'sine', 0.2);
        }
      } else if(kind==='bell'){
        // FM-ish bell: carrier with two partials and slow decay
        const freqs = [1174.66, 1567.98, 2093.00]; // D6, G6, C7
        for(let i=0;i<freqs.length;i++){
          note(freqs[i], now, 0.6, i? 'sine':'triangle', i?0.35:0.5);
        }
      } else if(kind==='ta-da'){
        // Classic taâ€‘da: perfect fourth then major third stacked
        note(659.25, now, 0.35, 'triangle', 0.6); // E5
        note(880.00, now+0.12, 0.45, 'sine', 0.5); // A5
        note(1046.5, now+0.22, 0.5, 'sine', 0.45); // C6
      } else if(kind==='sweep'){
        // Rising sweep with slight vibrato
        const o = osc('sine', 523.25, now);
        const g = env(o, now, 0.005, 0.05, 0.3, 0.45, 0.5);
        g.connect(ctx.destination);
        const f = o.frequency;
        f.setValueAtTime(440, now);
        f.exponentialRampToValueAtTime(1174.66, now+0.5);
        o.start(now); o.stop(now+0.55);
      } else if(kind==='kalimba'){
        // Plucked triads with exponential decay
        const triad = [523.25, 659.25, 783.99]; // C5 E5 G5
        triad.forEach((f,i)=> note(f, now + i*0.05, 0.4, 'triangle', 0.5));
      } else if(kind==='clap'){
        // Short noise clap + click
        noise(now, 0.12, 1000);
        note(2000, now, 0.05, 'square', 0.2);
      }
    }

    function resize(){
      dpr = Math.max(1, Math.min(window.devicePixelRatio || 1, 2));
      w = canvas.width = Math.floor(window.innerWidth * dpr);
      h = canvas.height = Math.floor(window.innerHeight * dpr);
      canvas.style.width = window.innerWidth + 'px';
      canvas.style.height = window.innerHeight + 'px';
      ctx.setTransform(1,0,0,1,0,0);
    }
    window.addEventListener('resize', resize, {passive:true});
    resize();

    function celebrate(){
      if(!prefersReduced && btn.animate){
        btn.animate([{transform:'scale(1)'},{transform:'scale(1.1)'},{transform:'scale(1)'}], {duration:220,easing:'ease-out'});
      }
      if(flashChk.checked){ btn.classList.add('ring'); setTimeout(()=>btn.classList.remove('ring'), 700); }

      const sel = soundSel.value;
      if(sel !== 'off'){ playSound(sel); }

      if(prefersReduced) return;

      const rect = btn.getBoundingClientRect();
      const cx = (rect.left + rect.width/2) * dpr;
      const cy = (rect.top + rect.height/2) * dpr;

      const style = styleSel.value;
      if(style === 'confetti'){ confetti(cx, cy, 260); }
      else if(style === 'firework'){ firework(cx, cy); }
      else { sparkleDOM(btn, 120); }

      if(sparkChk.checked){ sparkleDOM(btn, 60); }
    }

    // -------- Confetti (canvas) --------
    const COLORS = ['#F97316','#22C55E','#38BDF8','#A78BFA','#F43F5E','#EAB308','#10B981','#60A5FA','#fb7185','#93c5fd'];
    function confetti(cx, cy, count){
      const parts = [];
      for(let i=0;i<count;i++){
        const angle = Math.random()*Math.PI*2;
        const speed = 6 + Math.random()*6;
        const size = 6 + Math.random()*8;
        const color = COLORS[(Math.random()*COLORS.length)|0];
        const shape = Math.random()<0.2?'circle':'rect';
        parts.push({
          x: cx, y: cy,
          vx: Math.cos(angle)*speed, vy: Math.sin(angle)*speed - 6,
          g: 0.18 + Math.random()*0.12,
          s: size, a: 1,
          spin: (Math.random()<0.5? -1:1) * (0.08 + Math.random()*0.12),
          rot: Math.random()*Math.PI,
          color, shape
        });
      }
      animateParts(parts, function draw(p){
        ctx.globalAlpha = Math.max(0, p.a);
        ctx.fillStyle = p.color;
        ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot);
        if(p.shape === 'rect'){ ctx.fillRect(-p.s/2, -p.s/2, p.s, p.s*0.6); }
        else{ ctx.beginPath(); ctx.arc(0,0,p.s*0.5,0,Math.PI*2); ctx.fill(); }
        ctx.restore(); ctx.globalAlpha = 1;
      });
    }

    // -------- Firework (canvas) --------
    function firework(cx, cy){
      const parts = [];
      const rays = 26;
      for(let i=0;i<rays;i++){
        const angle = (i/rays)*Math.PI*2 + (Math.random()*0.12);
        const speed = 8 + Math.random()*3;
        parts.push(makeParticle(cx, cy, angle, speed, randColor(), 'ray'));
      }
      const ringCount = 48;
      for(let i=0;i<ringCount;i++){
        const angle = (i/ringCount)*Math.PI*2;
        const speed = 6 + Math.random()*2;
        parts.push(makeParticle(cx, cy, angle, speed, randColor(), 'dot'));
      }
      setTimeout(()=>{
        const n=42;
        for(let i=0;i<n;i++){
          const angle = Math.random()*Math.PI*2;
          const speed = 7 + Math.random()*3;
          parts.push(makeParticle(cx, cy, angle, speed, randColor(), 'crackle', 0.9));
        }
      }, 120);

      animateParts(parts, function draw(p){
        if(p.trail && p.trail.length>1){
          ctx.strokeStyle = p.color;
          ctx.globalAlpha = 0.35;
          ctx.lineWidth = 2 * (p.type==='ray' ? 1.2 : 1);
          ctx.beginPath();
          ctx.moveTo(p.trail[0].x, p.trail[0].y);
          for(let i=1;i<p.trail.length;i++) ctx.lineTo(p.trail[i].x, p.trail[i].y);
          ctx.stroke();
          ctx.globalAlpha = 1;
        }
        ctx.fillStyle = p.color;
        ctx.globalAlpha = Math.max(0, p.a);
        if(p.type==='dot' || p.type==='crackle'){
          ctx.beginPath(); ctx.arc(p.x, p.y, 3.2, 0, Math.PI*2); ctx.fill();
        }else{
          ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(Math.atan2(p.vy, p.vx));
          ctx.fillRect(-2, -1.6, 10, 3.2);
          ctx.restore();
        }
        ctx.globalAlpha = 1;
      }, { air:0.008, gravity:0.09, fade:0.010, trail:10, drag:0.012 });
    }

    function makeParticle(cx, cy, angle, speed, color, type='dot', alpha=1){
      return { x: cx, y: cy, vx: Math.cos(angle)*speed, vy: Math.sin(angle)*speed - 4, a: alpha, color, type, trail: [] };
    }
    function randColor(){
      const C = ['#F97316','#22C55E','#38BDF8','#A78BFA','#F43F5E','#EAB308','#10B981','#60A5FA','#fb7185','#93c5fd'];
      return C[(Math.random()*C.length)|0];
    }

    // -------- Sparkle DOM (extra or solo) --------
    function sparkleDOM(target, count){
      const rect = target.getBoundingClientRect();
      const cx = rect.left + rect.width/2 + window.scrollX;
      const cy = rect.top + rect.height/2 + window.scrollY;
      for(let i=0;i<count;i++){
        const p = document.createElement('span');
        p.className = 'sparkle';
        const angle = Math.random()*Math.PI*2;
        const dist = 90 + Math.random()*90;
        p.style.setProperty('--dx', Math.cos(angle)*dist + 'px');
        p.style.setProperty('--dy', Math.sin(angle)*dist + 'px');
        document.body.appendChild(p);
        p.style.left = cx + 'px'; p.style.top = cy + 'px';
        p.style.animation = `pop ${520+Math.random()*280}ms cubic-bezier(.16,1,.3,1) forwards`;
        setTimeout(()=>p.remove(), 1200);
      }
    }

    // -------- Shared animation loop for canvas parts --------
    function animateParts(parts, draw, opts){
      if(rafId) cancelAnimationFrame(rafId);
      const air = opts?.air ?? 0.005;
      const gravity = opts?.gravity ?? 0.18;
      const fade = opts?.fade ?? 0.012;
      const trailLen = opts?.trail ?? 0;
      const drag = opts?.drag ?? 0.0;

      let last = performance.now();
      function frame(t){
        ctx.clearRect(0,0,w,h);
        const dt = Math.min(32, t - last) / 16.6667; last = t;
        for(const p of parts){
          p.vx *= (1 - drag*dt);
          p.vy = (p.vy + gravity*dt) * (1 - air*dt);
          p.x += p.vx*dt; p.y += p.vy*dt;
          p.a -= fade*dt;

          if(trailLen){
            p.trail.push({x:p.x, y:p.y});
            if(p.trail.length>trailLen) p.trail.shift();
          }
        }
        for(const p of parts){ if(p.a>0) draw(p); }
        const alive = parts.some(p => p.a>0 && p.y < h+60);
        if(alive) rafId = requestAnimationFrame(frame);
        else { ctx.clearRect(0,0,w,h); rafId = null; }
      }
      rafId = requestAnimationFrame(frame);
    }

    btn.addEventListener('click', celebrate);
    btn.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); celebrate(); }});
    btn.focus();
  })();
  </script>
</body>
</html>
